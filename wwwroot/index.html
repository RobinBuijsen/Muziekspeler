<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="site.css">
    <title>Muziekspeler Web</title>
</head>
<body>
    <h1>Muziekspeler</h1>

    <div id="songList"></div>

    <p id="nowPlaying">Er speelt nog niets...</p>

    <script>
        async function fetchSongs() {
            const res = await fetch('/songs');
            const songs = await res.json();
            const container = document.getElementById('songList');
            container.innerHTML = '';

            songs.forEach(song => {
                const div = document.createElement('div');
                div.innerHTML = `
                        🎵 ${song.artist} - ${song.title} (${song.duration})
                        <button onclick="playSong('${song.id}')">▶️</button>
                        <button onclick="pause()">⏸️</button>
                    `;
                container.appendChild(div);
            });
        }

        function playSong(songId) {
            fetch(`/play/${songId}`, { method: 'POST' }).then(() => {
                startPolling();
            });
        }

        function pause() {
            fetch('/pause', { method: 'POST' }).then(() => {
                stopPolling();
                document.getElementById('nowPlaying').innerText = "⏸️ Gepauzeerd";
            });
        }

        function startPolling() {
            if (window.poller) return;
            window.poller = setInterval(updateNowPlaying, 2000);
        }

        function stopPolling() {
            clearInterval(window.poller);
            window.poller = null;
        }

        function updateNowPlaying() {
            fetch('/nowplaying')
                .then(res => res.text())
                .then(info => {
                    document.getElementById('nowPlaying').innerText = "🎵 Nu speelt: " + info;
                });
        }

        // Init
        fetchSongs();
    </script>
</body>
</html>
